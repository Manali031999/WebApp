
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>INDEX</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    <!-- Google Fonts Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    <!-- Your custom styles (optional) -->
    <link rel="stylesheet" href="/static/calc.css">
    </head>
<body>
      <div class="calculator card">

    <input type="text" id="displayresult" class="calculator-screen z-depth-1" value="" disabled />

    <div class="calculator-keys">

      <button type="button" class="operator btn btn-info" value="+">+</button>
      <button type="button" class="operator btn btn-info" value="-">-</button>
      <button type="button" class="operator btn btn-info" value="*">&times;</button>
      <button type="button" class="operator btn btn-info" value="/">&divide;</button>

      <button type="button" value="7" class="btn btn-light waves-effect">7</button>
      <button type="button" value="8" class="btn btn-light waves-effect">8</button>
      <button type="button" value="9" class="btn btn-light waves-effect">9</button>


      <button type="button" value="4" class="btn btn-light waves-effect">4</button>
      <button type="button" value="5" class="btn btn-light waves-effect">5</button>
      <button type="button" value="6" class="btn btn-light waves-effect">6</button>


      <button type="button" value="1" class="btn btn-light waves-effect">1</button>
      <button type="button" value="2" class="btn btn-light waves-effect">2</button>
      <button type="button" value="3" class="btn btn-light waves-effect">3</button>


      <button type="button" value="0" class="btn btn-light waves-effect">0</button>
      <button type="button" class="decimal function btn btn-secondary" value=".">.</button>
      <button type="button" class="all-clear function btn btn-danger btn-sm" value="all-clear">AC</button>

      <button type="button" class="equal-sign operator btn btn-default" value="=">=</button>

    </div>
  </div>

    <!-- Your custom scripts -->
    <!-- <script type="text/javascript" src="/static/calc.js"></script> -->
    <script>
    const calculator = {
      displayValue: '0',
      firstOperand: null,
      waitingForSecondOperand: false,
      operator: null,
    };

    function inputDigit(digit) {
      const { displayValue, waitingForSecondOperand } = calculator;

      if (waitingForSecondOperand === true) {
        calculator.displayValue = digit;
        console.log(calculator.displayValue);
        calculator.waitingForSecondOperand = false;
      } else {
        calculator.displayValue = displayValue === '0' ? digit : displayValue + digit;
        console.log(calculator.displayValue);
      }
    }

    function inputDecimal(dot) {
      // If the `displayValue` does not contain a decimal point
      if (!calculator.displayValue.includes(dot)) {
        // Append the decimal point
        calculator.displayValue += dot;
      }
    }

    function handleOperator(nextOperator) {
    const { firstOperand, displayValue, operator } = calculator
    const inputValue = parseFloat(displayValue);

    if (operator && calculator.waitingForSecondOperand)  {
      calculator.operator = nextOperator;
      return;
    }

    if (firstOperand == null) {
      calculator.firstOperand = inputValue;
    } else if (operator) {
        const currentValue = firstOperand || 0;
        console.log("Before Fetch")
        const result = Fetch(operator,currentValue,inputValue)
        result.then((data)=>{
          document.getElementById("displayresult").value = data.result;
          calculator.displayValue = String(data.result);
          calculator.firstOperand = data.result;
        })
    }

    calculator.waitingForSecondOperand = true;
    calculator.operator = nextOperator;
    }


    async function Fetch(operator,currentValue,inputValue){
      const settings = {
        method: 'POST',
        body: JSON.stringify({
            "operator": operator,
            "op1": currentValue.toString(),
            "op2":inputValue.toString(),
            "result":"",
        }),
        headers: {
             Accept: 'application/json',
            'Content-Type': 'application/json',
        }
      };
      console.log("Fetch Called")
      const response = await fetch('/Get',settings)
      const data = await response.json();
      console.log(data)
      return data;
    }

    function resetCalculator() {
      calculator.displayValue = '0';
      calculator.firstOperand = null;
      calculator.waitingForSecondOperand = false;
      calculator.operator = null;
    }

    function updateDisplay() {
      const display = document.querySelector('.calculator-screen');
      display.value = calculator.displayValue;
    }

    updateDisplay();

    const keys = document.querySelector('.calculator-keys');
    keys.addEventListener('click', (event) => {
      const { target } = event;
      if (!target.matches('button')) {
        return;
      }

      if (target.classList.contains('operator')) {
        handleOperator(target.value);
        console.log(target.value);
        updateDisplay();
        return;
      }

      if (target.classList.contains('decimal')) {
        inputDecimal(target.value);
        updateDisplay();
        return;
      }

      if (target.classList.contains('all-clear')) {
        resetCalculator();
        updateDisplay();
        return;
      }

      inputDigit(target.value);
      updateDisplay();
    });
</script>
</body>
</html>
